<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TMT Funnel Tracker</title>

  <!-- External Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

  <!-- Tailwind Config for Premium Green Theme -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tmt: {
              50: '#f0fdf4',
              100: '#dcfce7',
              200: '#bbf7d0',
              300: '#86efac',
              400: '#4ade80',
              500: '#22c55e',
              600: '#16a34a',
              700: '#15803d',
              800: '#166534',
              900: '#14532d',
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="./style.css" />
</head>

<body class="text-slate-800 antialiased font-sans h-screen flex flex-col overflow-hidden bg-tmt-50">

  <!-- Compact Navbar -->
  <nav class="bg-tmt-900 text-white shadow-sm z-50 flex-none h-12">
    <div class="w-full px-4 h-full flex justify-between items-center">
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-filter-circle-dollar text-tmt-400 text-base"></i>
        <span class="font-bold text-base tracking-wide">TMT Funnel Tracker</span>
      </div>

      <!-- Filters -->
      <div class="hidden md:flex items-center gap-2">
        <div class="flex items-center bg-tmt-800 rounded px-2 py-0.5">
          <input type="date" id="startDate" class="bg-transparent text-[10px] text-white border-none focus:ring-0 p-0 w-24">
          <span class="text-tmt-400 mx-1 text-[10px]">to</span>
          <input type="date" id="endDate" class="bg-transparent text-[10px] text-white border-none focus:ring-0 p-0 w-24">
        </div>

        <select id="channelFilter" class="bg-tmt-800 text-white text-[10px] border-none rounded px-2 py-1 focus:ring-0 cursor-pointer h-6">
          <option value="All">All Channels</option>
        </select>

        <button onclick="app.fetchData()" class="bg-tmt-600 hover:bg-tmt-500 text-white text-[10px] px-2 py-1 rounded transition shadow-sm h-6 flex items-center">
          <i class="fa-solid fa-sync mr-1"></i> Sync
        </button>
      </div>

      <div class="text-[10px] text-tmt-300 hidden sm:block" id="lastUpdated">Loading...</div>
    </div>
  </nav>

  <!-- Mobile Filter -->
  <div class="md:hidden bg-white p-2 border-b border-tmt-100 flex flex-wrap gap-2 justify-between items-center">
    <input type="date" id="startDateMobile" class="border border-tmt-200 rounded px-1 py-1 text-xs">
    <input type="date" id="endDateMobile" class="border border-tmt-200 rounded px-1 py-1 text-xs">
    <button onclick="app.fetchData()" class="bg-tmt-600 text-white text-xs px-2 py-1 rounded">Update</button>
  </div>

  <!-- Main Dashboard -->
  <main class="dash">
    <div id="errorContainer" class="hidden bg-red-50 border-l-4 border-red-500 p-2 rounded shadow-sm text-xs"></div>

    <!-- KPI Row -->
    <section id="kpiContainer" class="kpi-grid"></section>

    <!-- CPA Row -->
    <section id="kpiCPA" class="kpi-cpa-row"></section>

    <!-- Middle Row -->
    <section class="mid-grid">
      <div class="panel">
        <div class="panel-head">
          <h3><i class="fa-solid fa-arrow-down-wide-short mr-2 text-tmt-600"></i>Live Funnel Flow</h3>
          <button class="chip">Volume & Rates</button>
        </div>
        <div id="funnelContainer" class="panel-body funnel-body"></div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <h3><i class="fa-solid fa-chart-line mr-2 text-tmt-600"></i>Trends</h3>
          <div class="chip-group">
            <button class="chip" onclick="app.updateChartMetric('ctr')">CTR</button>
            <button class="chip" onclick="app.updateChartMetric('cpc')">CPC</button>
            <button class="chip" onclick="app.updateChartMetric('cpl')">CPL</button>
            <button class="chip" onclick="app.updateChartMetric('mer')">MER</button>
          </div>
        </div>
        <div class="panel-body chart-body">
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Focus Row (full width) -->
    <section class="focus-row">
      <div class="panel focus-panel">
        <div class="panel-head">
          <h3><i class="fa-solid fa-triangle-exclamation mr-2 text-amber-500"></i>Focus Area</h3>
          <div id="bottleneckStage" class="focus-stage">Analyzing...</div>
        </div>
        <div id="bottleneckRec" class="focus-text">Loading data...</div>
      </div>
    </section>

    <!-- Bottom Row -->
    <section class="bottom-grid">
      <div class="panel">
        <div class="panel-head">
          <h3><i class="fa-solid fa-clipboard-check mr-2 text-tmt-600"></i>Benchmarks</h3>
        </div>
        <div class="panel-body bench-body">
          <table class="bench-table">
            <thead>
              <tr>
                <th>Metric</th>
                <th class="right">Value</th>
                <th class="center">Status</th>
              </tr>
            </thead>
            <tbody id="benchmarkBody"></tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <h3>Data Log</h3>
          <input type="text" id="tableSearch" placeholder="Search..." class="search">
        </div>
        <div class="panel-body table-body">
          <table class="data-table">
            <thead><tr id="tableHeader"></tr></thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <script src="./script.js"></script>
</body>
</html>
